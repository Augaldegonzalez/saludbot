<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SaludBot: Asistente de Bienestar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chosen Palette: Vibrant Teal & Gold with Animated Gradients -->
    <!-- Application Structure Plan: The application structure remains a task-oriented SPA (Inicio, Metas, etc.). This update introduces real Gemini API calls. The Dashboard's "Consejo del D√≠a" is now powered by an LLM, and a new "Meal Analysis" feature has been added to the Tools section, also powered by Gemini. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Introduction section. Goal: Create a high-impact, welcoming experience. Method: Redesigned the "Inicio" section into a two-column hero layout featuring an animated mock-up of the app interface built with HTML/CSS. Justification: Provides a more "spectacular" and visually engaging introduction as requested. Library: CSS for animations.
        - Report Info: Calorie Calculator. Goal: Enhance usability with AI. Method: Added a "‚ú® Analizar Comida" button that sends the current meal list to the Gemini API for nutritional analysis. Justification: Adds significant value and demonstrates a practical use of LLMs. Library: JS (fetch).
        - Report Info: AI recommendation. Goal: Provide genuine, dynamic advice. Method: Replaced the simulated AI coach with a real Gemini API call that uses the user's latest data to generate a personalized tip. Justification: Fulfills the core promise of an "intelligent" assistant. Library: JS (fetch).
        - Report Info: Core functionality (Dashboard, editable tables). Goal: Maintain existing functionality. Method: No changes to the core logic, only visual enhancements. Interaction: On-scroll animations, glassmorphism cards, and interactive charts remain. Justification: The core app was well-received; changes focus on specific user requests. Library: JS (Intersection Observer), Chart.js.
        - CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        @keyframes gradient-animation {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(-45deg, #f8fafc, #f3f4f6, #e5e7eb, #f3f4f6);
            background-size: 400% 400%;
            animation: gradient-animation 15s ease infinite;
            color: #334155;
        }
        h1, h2, h3, h4, .font-serif {
            font-family: 'Lora', serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .nav-link {
            position: relative;
            transition: color 0.3s ease;
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -6px;
            left: 50%;
            background-color: #0d9488;
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        .nav-link:hover::after, .nav-link.active::after {
            width: 60%;
        }
        .nav-link.active {
            color: #0d9488;
            font-weight: 500;
        }
        .card {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 10px 30px -5px rgb(0 0 0 / 0.1);
        }
        .reveal {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .reveal.visible {
            opacity: 1;
            transform: translateY(0);
        }
        [contenteditable="true"] {
            cursor: pointer;
            outline: none;
            position: relative;
            background-color: #fefce8;
            padding: 2px 4px;
            border-radius: 4px;
        }
        [contenteditable="true"]:hover, [contenteditable="true"]:focus {
            background-color: #fef9c3;
            box-shadow: 0 0 0 2px #facc15;
        }
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .btn-primary {
            background-color: #0d9488;
            color: white;
        }
        .btn-primary:hover:not(:disabled) {
            background-color: #0f766e;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px -1px rgb(13 148 136 / 0.3);
        }
        .btn-secondary {
            background-color: #c084fc;
            color: white;
        }
        .btn-secondary:hover:not(:disabled) {
             background-color: #a855f7;
             transform: translateY(-2px);
             box-shadow: 0 4px 10px -1px rgb(168 85 247 / 0.3);
        }
        .btn-danger {
            background-color: #fca5a5;
            color: #b91c1c;
        }
        .btn-danger:hover {
            background-color: #f87171;
            color: #7f1d1d;
        }
        .modal {
            transition: opacity 0.25s ease;
        }
        .spinner {
            border: 2px solid rgba(0,0,0,.1);
            border-left-color: #0d9488;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 border-b border-gray-200/80">
        <div class="container mx-auto px-6">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center space-x-3">
                     <div class="bg-teal-600/10 p-2 rounded-full"><span class="text-xl">üåø</span></div>
                    <h1 class="text-2xl font-bold text-teal-700">SaludBot</h1>
                </div>
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="#inicio" class="nav-link px-1 py-2 text-sm font-medium text-gray-500 hover:text-teal-700">Inicio</a>
                    <a href="#metas" class="nav-link px-1 py-2 text-sm font-medium text-gray-500 hover:text-teal-700">Mis Metas</a>
                    <a href="#herramientas" class="nav-link px-1 py-2 text-sm font-medium text-gray-500 hover:text-teal-700">Herramientas</a>
                    <a href="#registro" class="nav-link px-1 py-2 text-sm font-medium text-gray-500 hover:text-teal-700">Registro</a>
                    <a href="#dashboard" class="nav-link px-1 py-2 text-sm font-medium text-gray-500 hover:text-teal-700">Dashboard</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-6">
        <div class="space-y-24 md:space-y-32">
            
            <section id="inicio" class="scroll-mt-24 reveal">
                <div class="grid lg:grid-cols-2 gap-16 items-center py-16">
                    <div class="text-left">
                        <h2 class="text-5xl md:text-6xl font-bold text-gray-800 font-serif mb-6">Un Asistente de Bienestar Innovador</h2>
                        <p class="max-w-2xl text-xl text-gray-600 mb-8">
                           Saludbot es un sistema innovador que integra Inteligencia Artificial para analizar, visualizar y mejorar los h√°bitos de salud de estudiantes y sus familias.
                        </p>
                        <div class="space-y-4">
                            <div class="flex items-start gap-3"><span class="text-2xl">‚úÖ</span><p class="text-lg text-gray-700"><strong class="font-semibold">Registra datos clave</strong> como alimentaci√≥n, ejercicio, sue√±o e hidrataci√≥n.</p></div>
                            <div class="flex items-start gap-3"><span class="text-2xl">‚úÖ</span><p class="text-lg text-gray-700"><strong class="font-semibold">Visualiza el progreso</strong> en un dashboard interactivo con gr√°ficos profesionales.</p></div>
                            <div class="flex items-start gap-3"><span class="text-2xl">‚úÖ</span><p class="text-lg text-gray-700"><strong class="font-semibold">Recibe recomendaciones personalizadas</strong> generadas por IA.</p></div>
                            <div class="flex items-start gap-3"><span class="text-2xl">‚úÖ</span><p class="text-lg text-gray-700"><strong class="font-semibold">Compara resultados</strong> con metas saludables y ve el impacto de tus cambios.</p></div>
                        </div>
                    </div>
                    <div class="hidden lg:block">
                        <div class="card p-4 aspect-[9/16] max-w-sm mx-auto shadow-2xl">
                           <div class="bg-gray-100 rounded-lg h-full p-4 space-y-4">
                               <div class="text-center"><p class="font-bold text-teal-700">Tu Dashboard</p></div>
                               <div class="bg-white p-3 rounded-lg shadow-sm"><p class="text-xs font-medium text-gray-500">PROMEDIO SUE√ëO</p><p class="text-2xl font-bold text-teal-600">7.2h</p></div>
                               <div class="bg-white p-3 rounded-lg shadow-sm"><p class="text-xs font-medium text-gray-500">CUMPLIMIENTO DE METAS</p><div class="h-20 bg-gray-200 rounded-md mt-2 flex gap-1 p-1"><div class="bg-blue-300 w-1/4 rounded-sm"></div><div class="bg-green-300 w-2/4 rounded-sm"></div><div class="bg-amber-300 w-1/4 rounded-sm"></div></div></div>
                               <div class="bg-gradient-to-br from-teal-50 to-emerald-100 p-3 rounded-lg shadow-sm"><p class="text-xs font-semibold text-teal-800">CONSEJO DEL D√çA</p><p class="text-sm text-teal-900 mt-1">¬°Gran trabajo con el ejercicio! Un poco m√°s de sue√±o podr√≠a potenciar tus resultados.</p></div>
                           </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="metas" class="scroll-mt-24 reveal">
                 <div class="text-left mb-12 max-w-4xl">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 font-serif">üéØ Mis Metas</h2>
                    <p class="mt-3 text-lg text-gray-600">Comienza por definir tus objetivos personales. Estos valores se usar√°n para calcular tu progreso en el dashboard.</p>
                </div>
                <div class="card p-6 max-w-md mx-auto">
                    <h3 class="text-2xl font-semibold mb-6 text-center text-gray-800">Tabla de Metas Diarias</h3>
                    <p class="text-center text-gray-500 mb-6 text-sm">Haz clic en cualquier valor para editarlo.</p>
                    <table class="w-full text-sm text-left"><thead class="bg-gray-50/70 rounded-t-lg"><tr><th class="p-3 font-medium text-gray-600">Categor√≠a</th><th class="p-3 font-medium text-gray-600">Meta Diaria</th></tr></thead><tbody id="metas-table-body"></tbody></table>
                </div>
            </section>

            <section id="herramientas" class="scroll-mt-24 reveal">
                <div class="text-left mb-12 max-w-4xl">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 font-serif">üõ†Ô∏è Herramientas</h2>
                    <p class="mt-3 text-lg text-gray-600">Utiliza estas herramientas para facilitar tu registro diario.</p>
                </div>
                <div class="card p-6">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-6 text-center">üßÆ Calculadora de Calor√≠as</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="font-semibold text-lg mb-2">Alimentos Comunes</h4>
                            <div id="predetermined-food-list" class="space-y-2 max-h-96 overflow-y-auto pr-2">
                                <!-- Lista de alimentos predeterminados -->
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg mb-2">Mi C√°lculo Diario</h4>
                             <form id="calorie-calculator-form" class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                                <div class="sm:col-span-2"><label for="food-name" class="sr-only">Alimento</label><input type="text" id="food-name" placeholder="Alimento (opcional)" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm"></div>
                                <div><label for="food-calories" class="sr-only">Calor√≠as</label><input type="number" id="food-calories" placeholder="Calor√≠as" required class="block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm"></div>
                                <div class="sm:col-span-3"><button type="submit" class="btn btn-primary w-full text-sm">A√±adir Manualmente</button></div>
                            </form>
                            <div id="calculator-list" class="space-y-2 mb-4 bg-gray-50/70 p-4 rounded-lg min-h-[8rem]"></div>
                            <div class="border-t pt-4 flex justify-between items-center">
                                <h4 class="text-lg font-bold">Total: <span id="calorie-total" class="text-teal-600">0</span> kcal</h4>
                                <button id="clear-calculator-btn" class="text-sm text-red-600 hover:text-red-800 font-medium">Limpiar</button>
                            </div>
                            <div class="mt-4">
                                <button id="analyze-meal-btn" class="btn btn-secondary w-full gap-2">‚ú® Analizar Comida con IA</button>
                                <div id="meal-analysis-result" class="mt-4 p-4 bg-purple-50 rounded-lg text-purple-900 border border-purple-200 hidden"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="registro" class="scroll-mt-24 reveal">
                 <div class="text-left mb-12 max-w-4xl">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 font-serif">üìù Registro Diario</h2>
                    <p class="mt-3 text-lg text-gray-600">A√±ade tu registro de hoy o edita entradas anteriores directamente en la tabla.</p>
                </div>
                 <div class="card p-6 md:p-8 mb-8">
                    <h3 class="text-2xl font-semibold text-gray-800 mb-6">A√±adir Nuevo Registro para Hoy</h3>
                    <form id="add-entry-form" class="grid grid-cols-2 md:grid-cols-3 gap-6 items-end">
                        <div><label class="block text-sm font-medium text-gray-700">üî• Calor√≠as</label><input type="number" name="calorias" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm"></div>
                        <div><label class="block text-sm font-medium text-gray-700">üèÉ Ejercicio (min)</label><input type="number" name="ejercicio" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm"></div>
                        <div><label class="block text-sm font-medium text-gray-700">üíß Agua (L)</label><input type="number" step="0.1" name="agua" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm"></div>
                        <div><label class="block text-sm font-medium text-gray-700">üò¥ Sue√±o (h)</label><input type="number" step="0.1" name="sueno" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-teal-500 focus:ring-teal-500 sm:text-sm"></div>
                        <div class="col-span-2 md:col-span-1"><label class="block text-sm font-medium text-gray-700">üòä Estado de √Ånimo (1-5)</label><input type="range" name="animo" min="1" max="5" value="3" step="1" required class="mt-2 block w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"></div>
                        <div class="col-span-2 md:col-span-3"><button type="submit" class="btn btn-primary w-full md:w-auto">A√±adir Registro</button></div>
                    </form>
                </div>
                <div class="card p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-2xl font-semibold text-gray-800">Historial de Registros</h3>
                        <button id="clear-history-btn" class="btn btn-danger text-sm">üóëÔ∏è Limpiar Historial</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left"><thead class="bg-gray-50/70"><tr><th class="p-3 font-medium text-gray-600">Fecha</th><th class="p-3 font-medium text-gray-600">Calor√≠as</th><th class="p-3 font-medium text-gray-600">Ejercicio</th><th class="p-3 font-medium text-gray-600">Agua</th><th class="p-3 font-medium text-gray-600">√Ånimo</th><th class="p-3 font-medium text-gray-600">Resumen</th></tr></thead><tbody id="registro-table-body"></tbody></table>
                    </div>
                </div>
            </section>
            
            <section id="dashboard" class="scroll-mt-24 reveal">
                <div class="text-left mb-12 max-w-4xl">
                    <h2 class="text-4xl md:text-5xl font-bold text-gray-800 font-serif">üìä Tu Dashboard</h2>
                    <p class="mt-3 text-lg text-gray-600">
                        Aqu√≠ tienes el resumen final de tu progreso y un consejo personalizado basado en tu √∫ltimo registro.
                    </p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
                    <div class="lg:col-span-3 space-y-8">
                        <div class="card p-6 md:p-8">
                             <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-8 gap-4 border-b pb-6 border-gray-200">
                                <h3 class="text-2xl font-semibold text-gray-800 font-serif">Resumen de H√°bitos</h3>
                                <div class="flex items-center space-x-2 border border-gray-200 rounded-full p-1 bg-gray-50 shadow-sm">
                                    <input type="date" id="startDate" class="bg-transparent border-none p-2 text-sm focus:ring-0 text-gray-600">
                                    <span class="text-gray-400 font-semibold">a</span>
                                    <input type="date" id="endDate" class="bg-transparent border-none p-2 text-sm focus:ring-0 text-gray-600">
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                                <div class="bg-gray-50/70 p-5 rounded-lg text-center border"><h4 class="text-sm text-gray-500 uppercase font-medium flex items-center justify-center gap-2"><span>üåô</span>Promedio Sue√±o</h4><p id="avgSleep" class="text-4xl font-bold text-teal-600 font-serif mt-1">--</p></div>
                                <div class="bg-gray-50/70 p-5 rounded-lg text-center border"><h4 class="text-sm text-gray-500 uppercase font-medium flex items-center justify-center gap-2"><span>üí™</span>Ejercicio Total</h4><p id="totalExercise" class="text-4xl font-bold text-teal-600 font-serif mt-1">--</p></div>
                                <div class="bg-gray-50/70 p-5 rounded-lg text-center border"><h4 class="text-sm text-gray-500 uppercase font-medium flex items-center justify-center gap-2"><span>‚úÖ</span>D√≠as Saludables</h4><p id="healthyDays" class="text-4xl font-bold text-teal-600 font-serif mt-1">--</p></div>
                            </div>
                        </div>
                        <div class="card p-6 md:p-8">
                            <h3 class="font-semibold mb-3 text-xl text-center text-gray-700">Tendencias de H√°bitos</h3>
                            <div class="chart-container"><canvas id="trendsChart"></canvas></div>
                        </div>
                    </div>
                     <div class="lg:col-span-1 space-y-8">
                        <div class="sticky top-28 space-y-8">
                            <div class="card bg-gradient-to-br from-teal-50 to-emerald-100/70 border p-8 rounded-2xl text-center">
                                <div class="flex items-center justify-center bg-white rounded-full w-16 h-16 mb-4 mx-auto shadow-md"><span class="text-3xl">üí°</span></div>
                                 <h3 class="font-semibold mb-2 text-teal-800 text-xl font-serif">Consejo del D√≠a</h3>
                                 <div id="ai-recommendation-container" class="min-h-[6rem] flex items-center justify-center">
                                    <p id="ai-recommendation" class="text-xl text-teal-900 transition-opacity duration-300 font-serif">Aqu√≠ tienes un consejo basado en tu √∫ltimo registro.</p>
                                 </div>
                            </div>
                             <div class="card p-6">
                                 <h3 class="font-semibold mb-3 text-xl text-center text-gray-700">Cumplimiento de Metas</h3>
                                 <div class="chart-container"><canvas id="complianceChart"></canvas></div>
                             </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <footer class="border-t border-gray-200 mt-24 bg-white">
        <div class="container mx-auto p-8 text-center text-gray-500">
            <p>SaludBot: Tu Asistente de Bienestar</p>
        </div>
    </footer>
    
    <div id="confirmation-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 opacity-0 pointer-events-none z-50">
        <div class="bg-white rounded-2xl shadow-xl max-w-sm w-full p-8 text-center">
            <div class="text-4xl mb-4">üóëÔ∏è</div>
            <h3 class="text-lg font-bold mb-2 text-gray-800">¬øEst√°s seguro?</h3>
            <p class="text-gray-600 mb-6">Esta acci√≥n no se puede deshacer. Se borrar√° todo tu historial de registros.</p>
            <div class="flex justify-center gap-4">
                <button id="cancel-clear-btn" class="btn bg-gray-200 hover:bg-gray-300 text-gray-800">Cancelar</button>
                <button id="confirm-clear-btn" class="btn btn-danger">S√≠, limpiar</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- INITIAL DATA AND STATE ---
        let sampleData = [ { fecha: '2025-06-18', calorias: 2200, ejercicio: 30, sueno: 6.5, agua: 1.8, animo: 3 }, { fecha: '2025-06-19', calorias: 1900, ejercicio: 45, sueno: 7.5, agua: 2.2, animo: 4 }, { fecha: '2025-06-20', calorias: 2100, ejercicio: 20, sueno: 7.0, agua: 2.0, animo: 3 }, { fecha: '2025-06-21', calorias: 1850, ejercicio: 60, sueno: 8.0, agua: 2.5, animo: 5 }, { fecha: '2025-06-22', calorias: 2350, ejercicio: 0, sueno: 6.0, agua: 1.5, animo: 2 }, { fecha: '2025-06-23', calorias: 2000, ejercicio: 35, sueno: 7.5, agua: 2.1, animo: 4 }];
        let METAS = { calorias: 2000, ejercicio: 30, sueno: 7.5, agua: 2 };
        const metasConfig = [ { key: 'calorias', label: 'Calor√≠as (m√°x)', suffix: '' }, { key: 'ejercicio', label: 'Ejercicio (m√≠n)', suffix: ' min' }, { key: 'sueno', label: 'Sue√±o (m√≠n)', suffix: ' h' }, { key: 'agua', label: 'Agua (m√≠n)', suffix: ' L' } ];
        let dataWithCompliance = [];
        let trendsChart, complianceChart;
        let calculatorItems = [];
        const predeterminedFoods = [
            { name: 'Manzana', portion: '1 mediana', calories: 95 }, { name: 'Pl√°tano', portion: '1 mediano', calories: 105 }, { name: 'Naranja', portion: '1 mediana', calories: 62 }, { name: 'Fresas', portion: '1 taza', calories: 49 }, { name: 'Uvas', portion: '1 taza', calories: 104 }, { name: 'Sand√≠a', portion: '1 taza', calories: 46 },
            { name: 'Pechuga de Pollo', portion: '100g asada', calories: 165 }, { name: 'Bistec de Res', portion: '100g a la plancha', calories: 250 }, { name: 'Huevo', portion: '1 grande', calories: 78 }, { name: 'Salm√≥n', portion: '100g al horno', calories: 208 }, { name: 'Lentejas', portion: '1 taza cocida', calories: 230 }, { name: 'Garbanzos', portion: '1 taza cocida', calories: 269 }, { name: 'At√∫n en lata', portion: '1 lata (85g)', calories: 99 },
            { name: 'Arroz Blanco', portion: '1 taza cocido', calories: 205 }, { name: 'Arroz Integral', portion: '1 taza cocido', calories: 216 }, { name: 'Avena', portion: '1/2 taza seca', calories: 150 }, { name: 'Pan integral', portion: '1 rebanada', calories: 80 }, { name: 'Pasta', portion: '1 taza cocida', calories: 221 }, { name: 'Quinoa', portion: '1 taza cocida', calories: 222 }, { name: 'Tortilla de ma√≠z', portion: '1 unidad', calories: 60 },
            { name: 'Aguacate', portion: '1/2 mediano', calories: 160 }, { name: 'Almendras', portion: '23 unidades', calories: 164 }, { name: 'Nueces', portion: '7 unidades', calories: 185 }, { name: 'Aceite de Oliva', portion: '1 cda', calories: 119 },
            { name: 'Br√≥coli', portion: '1 taza', calories: 55 }, { name: 'Espinaca', portion: '1 taza', calories: 7 }, { name: 'Zanahoria', portion: '1 mediana', calories: 25 }, { name: 'Tomate', portion: '1 mediano', calories: 22 }, { name: 'Pepino', portion: '1/2 mediano', calories: 20 },
            { name: 'Leche', portion: '1 taza', calories: 103 }, { name: 'Yogur Griego', portion: '1 taza', calories: 100 }, { name: 'Queso Cheddar', portion: '30g', calories: 114 }, { name: 'Queso Panela', portion: '30g', calories: 72 },
            { name: 'Refresco (Cola)', portion: '1 lata (355ml)', calories: 140 }, { name: 'Jugo de Naranja', portion: '1 taza', calories: 112 }, { name: 'Caf√© negro', portion: '1 taza', calories: 2 }
        ];

        function recalculateCompliance() {
            dataWithCompliance = sampleData.map(d => ({ ...d, diaSaludable: d.calorias <= METAS.calorias && d.ejercicio >= METAS.ejercicio && d.sueno >= METAS.sueno && d.agua >= METAS.agua, cumpleCalorias: d.calorias <= METAS.calorias, cumpleEjercicio: d.ejercicio >= METAS.ejercicio, cumpleSueno: d.sueno >= METAS.sueno, cumpleAgua: d.agua >= METAS.agua }));
            dataWithCompliance.sort((a, b) => new Date(a.fecha) - new Date(b.fecha));
        }

        function renderMetasTable() {
            const tbody = document.getElementById('metas-table-body');
            tbody.innerHTML = '';
            metasConfig.forEach((meta, index) => {
                const row = document.createElement('tr'); row.className = index % 2 === 0 ? 'border-b border-gray-200' : 'border-b border-gray-200 bg-gray-50/50';
                row.innerHTML = `<td class="p-3 font-medium text-gray-700">${meta.label}</td><td class="p-3" contenteditable="true" data-key="${meta.key}">${METAS[meta.key]}${meta.suffix}</td>`;
                tbody.appendChild(row);
            });
        }

        function renderRegistroTable() {
            const tbody = document.getElementById('registro-table-body');
            tbody.innerHTML = '';
            recalculateCompliance();
            dataWithCompliance.forEach((d, index) => {
                const row = document.createElement('tr'); row.className = 'border-b border-gray-200 hover:bg-gray-50';
                const resumenClass = d.diaSaludable ? 'bg-teal-100 text-teal-800' : 'bg-amber-100 text-amber-800';
                const resumenText = d.diaSaludable ? 'Saludable' : 'Ajustar';
                row.innerHTML = `<td class="p-3">${new Date(d.fecha+'T00:00:00').toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' })}</td><td class="p-3" contenteditable="true" data-index="${index}" data-key="calorias">${d.calorias}</td><td class="p-3" contenteditable="true" data-index="${index}" data-key="ejercicio">${d.ejercicio} min</td><td class="p-3" contenteditable="true" data-index="${index}" data-key="agua">${d.agua} L</td><td class="p-3" contenteditable="true" data-index="${index}" data-key="animo">${d.animo}/5</td><td class="p-3"><span class="${resumenClass} px-2.5 py-1 rounded-full text-xs font-semibold">${resumenText}</span></td>`;
                tbody.appendChild(row);
            });
            filterAndRenderDashboard();
        }
        
        function updateDashboard(filteredData) {
            const avgSleepEl = document.getElementById('avgSleep'), totalExerciseEl = document.getElementById('totalExercise'), healthyDaysEl = document.getElementById('healthyDays');
            if (!filteredData.length) { [avgSleepEl, totalExerciseEl, healthyDaysEl].forEach(el => el.textContent = 'N/A'); if (trendsChart) trendsChart.destroy(); if (complianceChart) complianceChart.destroy(); return; }
            avgSleepEl.textContent = (filteredData.reduce((a, d) => a + d.sueno, 0) / filteredData.length).toFixed(1) + ' h';
            totalExerciseEl.textContent = filteredData.reduce((a, d) => a + d.ejercicio, 0) + ' min';
            healthyDaysEl.textContent = `${filteredData.filter(d => d.diaSaludable).length} / ${filteredData.length}`;
            const labels = filteredData.map(d => new Date(d.fecha+'T00:00:00').toLocaleDateString('es-ES', { day: '2-digit', month: '2-digit' }));
            if (trendsChart) trendsChart.destroy();
            trendsChart = new Chart(document.getElementById('trendsChart').getContext('2d'), { type: 'line', data: { labels, datasets: [{ label: 'Calor√≠as', data: filteredData.map(d => d.calorias), borderColor: '#f97316', backgroundColor: '#f9731620', tension: 0.4, fill: true }, { label: 'Sue√±o (h)', data: filteredData.map(d => d.sueno), borderColor: '#0d9488', backgroundColor: '#0d948820', tension: 0.4, fill: true }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: false } }, plugins: { legend: { position: 'bottom' } } } });
            if (complianceChart) complianceChart.destroy();
            const complianceData = [ (filteredData.length ? filteredData.filter(d => d.cumpleCalorias).length / filteredData.length * 100 : 0).toFixed(0), (filteredData.length ? filteredData.filter(d => d.cumpleEjercicio).length / filteredData.length * 100 : 0).toFixed(0), (filteredData.length ? filteredData.filter(d => d.cumpleSueno).length / filteredData.length * 100 : 0).toFixed(0), (filteredData.length ? filteredData.filter(d => d.cumpleAgua).length / filteredData.length * 100 : 0).toFixed(0) ];
            complianceChart = new Chart(document.getElementById('complianceChart').getContext('2d'), { type: 'bar', data: { labels: ['Calor√≠as', 'Ejercicio', 'Sue√±o', 'Agua'], datasets: [{ label: '% de Cumplimiento', data: complianceData, backgroundColor: ['#fdba74', '#86efac', '#93c5fd', '#67e8f9'], borderRadius: 4 }] }, options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { beginAtZero: true, max: 100, grid: { display: false }, ticks: { callback: value => value + '%' } } }, plugins: { legend: { display: false } } } });
        }
        
        function filterAndRenderDashboard() {
            const start = new Date(document.getElementById('startDate').value + 'T00:00:00'); const end = new Date(document.getElementById('endDate').value + 'T23:59:59');
            const filtered = dataWithCompliance.filter(d => { const current = new Date(d.fecha); return current >= start && current <= end; });
            updateDashboard(filtered);
        }

        async function getAiRecommendation() {
            const container = document.getElementById('ai-recommendation-container');
            const p = document.getElementById('ai-recommendation');
            p.style.opacity = 0;
            container.innerHTML = '<div class="spinner"></div>';
            
            const latestData = dataWithCompliance.length > 0 ? dataWithCompliance[dataWithCompliance.length - 1] : null;
            if (!latestData) {
                container.innerHTML = '<p id="ai-recommendation" class="text-xl text-teal-900 transition-opacity duration-300 font-serif">Registra tus datos de hoy para recibir un consejo.</p>';
                return;
            }

            const prompt = `Eres un coach de bienestar motivacional. Basado en los datos de hoy, dame un consejo breve (m√°ximo 30 palabras), accionable y positivo. Hoy consum√≠ ${latestData.calorias} kcal, hice ${latestData.ejercicio} minutos de ejercicio, dorm√≠ ${latestData.sueno} horas, y mi √°nimo fue ${latestData.animo} de 5.`;

            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = "AIzaSyCnab2aAJ8zVAULErGWnIc3ZaIvv4P1r4I";
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) throw new Error(`API error: ${response.status}`);
                
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                container.innerHTML = `<p id="ai-recommendation" class="text-xl text-teal-900 transition-opacity duration-300 font-serif">${text}</p>`;
                setTimeout(() => document.getElementById('ai-recommendation').style.opacity = 1, 10);

            } catch (error) {
                console.error("Error fetching AI recommendation:", error);
                container.innerHTML = '<p id="ai-recommendation" class="text-xl text-red-700 transition-opacity duration-300 font-serif">No se pudo obtener el consejo. Int√©ntalo m√°s tarde.</p>';
            }
        }

        function renderPredeterminedFoods() {
            const listEl = document.getElementById('predetermined-food-list');
            listEl.innerHTML = '';
            predeterminedFoods.forEach(food => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-gray-50 p-2 rounded-md border';
                div.innerHTML = `
                    <div>
                        <span class="font-medium">${food.name}</span>
                        <span class="text-xs text-gray-500 block">${food.portion}</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-sm font-bold text-teal-600">${food.calories} kcal</span>
                        <button data-name="${food.name}" data-calories="${food.calories}" class="add-predetermined-food-btn bg-teal-100 text-teal-700 w-7 h-7 rounded-full text-lg font-bold flex items-center justify-center hover:bg-teal-200 transition-colors">+</button>
                    </div>
                `;
                listEl.appendChild(div);
            });
        }

        function renderCalculator() {
            const listEl = document.getElementById('calculator-list');
            const totalEl = document.getElementById('calorie-total');
            listEl.innerHTML = '';
            let total = 0;
            if (calculatorItems.length === 0) {
                listEl.innerHTML = '<p class="text-center text-sm text-gray-500">A√±ade alimentos para calcular.</p>';
            }
            calculatorItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'flex justify-between items-center bg-white p-2 rounded-md border-l-4 border-teal-500';
                div.innerHTML = `<span>${item.name || 'Alimento'}</span><span class="font-bold">${item.calories} kcal</span>`;
                listEl.appendChild(div);
                total += item.calories;
            });
            totalEl.textContent = total;
        }

        async function getMealAnalysis() {
            const analyzeBtn = document.getElementById('analyze-meal-btn');
            const resultContainer = document.getElementById('meal-analysis-result');
            
            if (calculatorItems.length === 0) {
                resultContainer.innerHTML = 'A√±ade alimentos a tu c√°lculo primero.';
                resultContainer.classList.remove('hidden');
                return;
            }

            analyzeBtn.disabled = true;
            analyzeBtn.innerHTML = '<div class="spinner"></div>';
            resultContainer.classList.add('hidden');

            const foodList = calculatorItems.map(item => `${item.name} (${item.calories} kcal)`).join(', ');
            const prompt = `Eres un nutricionista. Analiza brevemente esta comida (m√°ximo 40 palabras) y sugiere una mejora simple y accionable. La comida consiste en: ${foodList}.`;

            try {
                const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                const apiKey = "AIzaSyCnab2aAJ8zVAULErGWnIc3ZaIvv4P1r4I";
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                if (!response.ok) throw new Error(`API error: ${response.status}`);
                const result = await response.json();
                const text = result.candidates[0].content.parts[0].text;
                resultContainer.innerHTML = text;
            } catch (error) {
                console.error("Error fetching meal analysis:", error);
                resultContainer.innerHTML = 'No se pudo obtener el an√°lisis. Int√©ntalo m√°s tarde.';
            } finally {
                analyzeBtn.disabled = false;
                analyzeBtn.innerHTML = '‚ú® Analizar Comida con IA';
                resultContainer.classList.remove('hidden');
            }
        }

        document.getElementById('metas-table-body').addEventListener('blur', (e) => { if (e.target.isContentEditable) { const key = e.target.dataset.key, value = parseFloat(e.target.textContent) || 0; METAS[key] = value; renderMetasTable(); renderRegistroTable(); } }, true);
        document.getElementById('registro-table-body').addEventListener('blur', (e) => { if (e.target.isContentEditable) { const index = e.target.dataset.index, key = e.target.dataset.key, value = parseFloat(e.target.textContent) || 0; if(sampleData[index]) { sampleData[index][key] = value; renderRegistroTable(); getAiRecommendation(); } } }, true);
        
        document.getElementById('add-entry-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const newEntry = {
                fecha: new Date().toISOString().split('T')[0],
                calorias: parseFloat(formData.get('calorias')),
                ejercicio: parseFloat(formData.get('ejercicio')),
                sueno: parseFloat(formData.get('sueno')),
                agua: parseFloat(formData.get('agua')),
                animo: parseInt(formData.get('animo'))
            };
            sampleData.push(newEntry);
            e.target.reset();
            renderRegistroTable();
            getAiRecommendation();
            document.getElementById('endDate').value = newEntry.fecha;
            filterAndRenderDashboard();
        });

        document.getElementById('calorie-calculator-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const nameInput = document.getElementById('food-name');
            const caloriesInput = document.getElementById('food-calories');
            calculatorItems.push({ name: nameInput.value, calories: parseInt(caloriesInput.value) });
            renderCalculator();
            e.target.reset();
        });
        
        document.getElementById('predetermined-food-list').addEventListener('click', (e) => {
            if (e.target.closest('.add-predetermined-food-btn')) {
                const button = e.target.closest('.add-predetermined-food-btn');
                const name = button.dataset.name;
                const calories = parseInt(button.dataset.calories);
                calculatorItems.push({ name, calories });
                renderCalculator();
            }
        });

        document.getElementById('clear-calculator-btn').addEventListener('click', () => {
            calculatorItems = [];
            renderCalculator();
        });
        
        document.getElementById('analyze-meal-btn').addEventListener('click', getMealAnalysis);
        
        const modal = document.getElementById('confirmation-modal');
        document.getElementById('clear-history-btn').addEventListener('click', () => {
            modal.classList.remove('opacity-0', 'pointer-events-none');
        });
        document.getElementById('cancel-clear-btn').addEventListener('click', () => {
            modal.classList.add('opacity-0', 'pointer-events-none');
        });
        document.getElementById('confirm-clear-btn').addEventListener('click', () => {
            sampleData = [];
            renderRegistroTable();
            getAiRecommendation();
            modal.classList.add('opacity-0', 'pointer-events-none');
        });


        [document.getElementById('startDate'), document.getElementById('endDate')].forEach(el => el.addEventListener('change', filterAndRenderDashboard));
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.reveal').forEach(el => {
            observer.observe(el);
        });

        const navLinks = document.querySelectorAll('.nav-link'), sections = document.querySelectorAll('section[id]');
        window.addEventListener('scroll', () => {
            let current = 'inicio'; sections.forEach(section => { if (pageYOffset >= section.offsetTop - 90) current = section.getAttribute('id'); });
            navLinks.forEach(link => { link.classList.remove('active'); if (link.getAttribute('href').includes(current)) link.classList.add('active'); });
        });
        
        function init() {
            if (sampleData.length > 0) {
              document.getElementById('startDate').value = sampleData[0].fecha;
              document.getElementById('endDate').value = sampleData[sampleData.length - 1].fecha;
            }
            renderMetasTable();
            renderRegistroTable();
            getAiRecommendation();
            renderPredeterminedFoods();
            renderCalculator();
            document.querySelector('.nav-link[href="#inicio"]').classList.add('active');
        }
        init();
    });
    </script>
</body>
</html>
